<!--pages/index/index.wxml-->
<view class="container">
  <!-- 1. 加载状态 -->
  <view class="status-container" wx:if="{{isLoading}}">
    <view class="loading-text">正在加载您的信息...</view>
  </view>

  <!-- 2. 加载完成后的界面 -->
  <block wx:else>
    <!-- 2.1 如果用户没有家族 -->
    <view class="status-container" wx:if="{{families.length === 0}}">
      <view class="empty-text">您还未加入任何家族</view>
      <view class="empty-tip">可以立即创建一个，邀请家人加入</view>
      <button class="create-btn" bindtap="showCreateFamilyModal">创建我的家族</button>
    </view>

    <!-- 2.2 如果用户有家族 -->
    <block wx:else>
      <!-- 顶部家族切换栏 -->
      <view class="header">
        <scroll-view scroll-x="true" class="family-tabs">
          <view 
            wx:for="{{families}}" 
            wx:key="id" 
            class="tab-item {{item.id === activeFamilyId ? 'active' : ''}}"
            bindtap="switchFamily"
            data-id="{{item.id}}"
          >
            {{item.name}}
          </view>
        </scroll-view>
        <view class="header-actions">
          <button class="action-btn" size="mini" bindtap="showCreateFamilyModal">+</button>
        </view>
      </view>

      <!-- 族谱树容器 -->
      <scroll-view scroll-x="true" scroll-y="true" class="tree-scroll-view">
        <!-- 如果有数据，则显示树 -->
        <view class="tree-container" wx:if="{{activeFamilyData}}">
          <member-card member="{{activeFamilyData}}"></member-card>
        </view>
        <!-- 如果正在加载树，则显示加载中 -->
        <view class="status-container" wx:elif="{{isTreeLoading}}">
            <view class="loading-text">正在加载族谱...</view>
        </view>
        <!-- 如果家族为空，则显示添加始祖的入口 -->
        <view class="status-container" wx:else>
            <view class="empty-text">该家族暂无成员数据</view>
            <view class="empty-tip">请先添加家族的始祖</view>
            <button class="create-btn" bindtap="showAddMemberModal">添加始祖</button>
        </view>
      </scroll-view>
    </block>
  </block>

  <!-- 创建家族的弹窗 (保持不变) -->
  <view class="modal-mask" wx:if="{{showModal}}" bindtap="hideCreateFamilyModal">
    <view class="modal-content" catchtap>
      <view class="modal-title">创建新家族</view>
      <input class="modal-input" placeholder="请输入家族名称" model:value="{{newFamilyName}}"/>
      <textarea class="modal-textarea" placeholder="请输入家族简介（选填）" model:value="{{newFamilyDesc}}"/>
      <button class="modal-confirm-btn" bindtap="handleCreateFamily">确认创建</button>
    </view>
  </view>

  <!-- 添加成员的弹窗 (已修改) -->
  <view class="modal-mask" wx:if="{{showAddMemberModal}}" bindtap="hideAddMemberModal">
    <view class="modal-content" catchtap>
      <view class="modal-title">添加始祖</view>
      <!-- 修改：使用 bindinput 来调用 onNameInput 函数 -->
      <input class="modal-input" placeholder="请输入始祖姓名" value="{{newMember.name}}" bindinput="onNameInput"/>
      <radio-group class="radio-group" bindchange="onGenderChange">
        <label class="radio"><radio value="male" checked/> 男</label>
        <label class="radio"><radio value="female"/> 女</label>
      </radio-group>
      <button class="modal-confirm-btn" bindtap="handleCreateMember">确认添加</button>
    </view>
  </view>

</view>
