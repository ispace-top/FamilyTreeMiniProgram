<!--components/member-card/member-card.wxml-->
<view class="member-node" wx:if="{{member}}">
  <view class="couple-container">
    <view class="card-wrapper">
      <view 
        class="member-card {{member.gender}} {{member.status}}" 
        bindtap="onCardTap"
        data-id="{{member.id}}"
      >
        <view class="avatar {{member.gender}} {{member.status}}"></view>
        <view class="name">{{member.name}}</view>
      </view>
      <view wx:if="{{member.children && member.children.length > 0}}" class="toggle-btn" bindtap="toggleCollapse">
        {{isCollapsed ? '+' : '-'}}
      </view>
    </view>
    <view class="spouse-card-wrapper" wx:if="{{member.spouses && member.spouses.length > 0}}">
      <view class="connector-spouse"></view>
      <block wx:for="{{member.spouses}}" wx:key="id">
        <view class="child-node">
          <!-- 关键：将 user-role 属性继续传递给下一级 -->
          <member-card 
            member="{{item}}"
            user-role="{{userRole}}"
          ></member-card>
        </view>
      </block>
      <!-- <view 
        class="member-card {{member.spouse.gender}} {{member.spouse.status}}"
        bindtap="onCardTap"
        data-id="{{member.spouse.id}}"
      >
        <view class="avatar {{member.spouse.gender}} {{member.spouse.status}}"></view>
        <view class="name">{{member.spouse.name}}</view>
      </view> -->
    </view>
  </view>

  <!-- 子女节点 (递归调用) -->
  <view class="children-container" wx:if="{{!isCollapsed && member.children && member.children.length > 0}}">
    <view class="connector-down"></view>
    <view class="children-nodes">
      <block wx:for="{{member.children}}" wx:key="id">
        <view class="child-node">
          <!-- 关键：将 user-role 属性继续传递给下一级 -->
          <member-card 
            member="{{item}}"
            user-role="{{userRole}}"
          ></member-card>
        </view>
      </block>
    </view>
  </view>
</view>
