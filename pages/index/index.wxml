<!--pages/index/index.wxml-->
<view class="container">
  <!-- 1. хКаш╜╜чК╢цАБ -->
  <view class="status-container" wx:if="{{isLoading}}">
    <view class="loading-text">цнгхЬихКаш╜╜цВичЪДф┐бцБп...</view>
  </view>

  <!-- 2. хКаш╜╜хоМцИРхРОчЪДчХМщЭв -->
  <block wx:else>
    <!-- 2.1 хжВцЮЬчФицИ╖ц▓бцЬЙхо╢цЧП -->
    <view class="status-container" wx:if="{{families.length === 0}}">
      <view class="empty-text">цВиш┐ШцЬкхКахЕеф╗╗ф╜Ххо╢цЧП</view>
      <view class="empty-tip">хПпф╗ечлЛхН│хИЫх╗║ф╕Аф╕кя╝МщВАшп╖хо╢ф║║хКахЕе</view>
      <button class="create-btn" bindtap="showCreateFamilyModal">хИЫх╗║цИСчЪДхо╢цЧП</button>
    </view>

    <!-- 2.2 хжВцЮЬчФицИ╖цЬЙхо╢цЧП -->
    <block wx:else>
      <!-- щб╢щГихо╢цЧПхИЗцНвцаП -->
      <view class="header">
        <scroll-view scroll-x="true" class="family-tabs">
          <view 
            wx:for="{{families}}" 
            wx:key="id" 
            class="tab-item {{item.id === activeFamilyId ? 'active' : ''}}"
            bindtap="switchFamily"
            data-id="{{item.id}}"
          >
            {{item.name}}
          </view>
        </scroll-view>
        <view class="header-actions">
          <button class="action-btn" size="mini" bindtap="showCreateFamilyModal">+</button>
        </view>
      </view>

      <!-- цРЬч┤вцаП -->
      <view class="search-wrapper" bindtap="navigateToSearch">
        <view class="search-fake-input">
          <text class="search-icon">ЁЯФН</text>
          <text class="search-placeholder">цРЬч┤вцИРхСШ...</text>
        </view>
      </view>

      <!-- цЧПш░▒цаСхо╣хЩи -->
      <scroll-view scroll-x="true" scroll-y="true" class="tree-scroll-view">
        <view class="tree-container" wx:if="{{activeFamilyData}}">
          <member-card 
            member="{{activeFamilyData}}"
            user-role="{{currentUserRole}}"
          ></member-card>
        </view>
        <view class="status-container" wx:elif="{{isTreeLoading}}">
            <view class="loading-text">цнгхЬихКаш╜╜цЧПш░▒...</view>
        </view>
        <view class="status-container" wx:else>
            <view class="empty-text">шпехо╢цЧПцЪВцЧацИРхСШцХ░цНо</view>
            <view class="empty-tip">шп╖хЕИц╖╗хКахо╢цЧПчЪДхзЛчеЦ</view>
            <button class="create-btn" bindtap="showAddMemberModal">ц╖╗хКахзЛчеЦ</button>
        </view>
      </scroll-view>
    </block>
  </block>

  <!-- хИЫх╗║хо╢цЧПчЪДх╝╣чкЧ -->
  <view class="modal-mask" wx:if="{{showModal}}" bindtap="hideCreateFamilyModal">
    <view class="modal-content" catchtap>
      <view class="modal-title">хИЫх╗║цЦ░хо╢цЧП</view>
      <input class="modal-input" placeholder="шп╖ш╛УхЕехо╢цЧПхРНчз░" model:value="{{newFamilyName}}"/>
      <textarea class="modal-textarea" placeholder="шп╖ш╛УхЕехо╢цЧПчоАф╗Ля╝ИщАЙхбля╝Й" model:value="{{newFamilyDesc}}"/>
      <button class="modal-confirm-btn" bindtap="handleCreateFamily">чбошодхИЫх╗║</button>
    </view>
  </view>

  <!-- ц╖╗хКацИРхСШчЪДх╝╣чкЧ -->
  <view class="modal-mask" wx:if="{{showAddMemberModal}}" bindtap="hideAddMemberModal">
    <view class="modal-content" catchtap>
      <view class="modal-title">ц╖╗хКахзЛчеЦ</view>
      <input class="modal-input" placeholder="шп╖ш╛УхЕехзЛчеЦхзУхРН" value="{{newMember.name}}" bindinput="onNameInput"/>
      <radio-group class="radio-group" bindchange="onGenderChange">
        <label class="radio"><radio value="male" checked/> чФ╖</label>
        <label class="radio"><radio value="female"/> хе│</label>
      </radio-group>
      <button class="modal-confirm-btn" bindtap="handleCreateMember">чбошодц╖╗хКа</button>
    </view>
  </view>

</view>
